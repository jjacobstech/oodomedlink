import{r as f,a as v,g as c,e as p,b as l,p as L,w as k,f as t,i as y,o as m,s as g,q as _,v as D,t as h,z as E,l as U,F as P,h as B}from"./app-D-K43tbR.js";import{A as j}from"./AuthLayout-Cfi-4KNs.js";import{u as z,o as x,e as b,s as w,_ as M,a as $,f as V}from"./PasswordInput-DB9O8II0.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./x-CgLIQk6J.js";import"./index-Bk0xNDQr.js";const G={class:"relative z-10 container mx-auto w-3-1/2 py-12 flex items-center justify-center min-h-[calc(100vh-80px)]"},H={class:"max-w-xl px-5"},J={class:"p-6 space-y-4 bg-white"},K={class:"space-y-2"},Q=["disabled"],W={class:"mt-6 text-center"},X={class:"lg:text-2xl text-gray-600"},Y={class:"space-y-2"},Z={class:"text-sm text-gray-500 mb-2"},ee=["disabled"],te={class:"mt-4 text-center"},re=["disabled"],ae=["for"],se=["disabled"],ue={__name:"ForgotPassword",setup(oe){const r=f(!1),u=f(1),{toast:o}=z(),S=sessionStorage.getItem("email"),n=v({email:""}),i=v({otp:"",email:""}),C=f([{id:"new-password",name:"New Password",placeholder:"Create a new password",type:"password",required:!0,autocomplete:"new-password",model:"password"},{id:"password_confirmation",name:"Confirm New Password",placeholder:"Confirm your new password",type:"password",required:!0,autocomplete:"new-password",model:"password_confirmation"}]),d=v({email:"",password:"",password_confirmation:"",otp:""}),F=x({email:b("Invalid email address").min(1,"Email is required")}),R=x({otp:w().length(6,"OTP must be 6 digits"),email:b("Invalid email address")}),q=x({email:b("Invalid email address").min(1,"Email is required"),otp:w().length(6,"OTP must be 6 digits"),password:w().min(6,"Password must be at least 6 characters"),password_confirmation:w().min(6,"Password confirmation is required")}).refine(s=>s.password===s.password_confirmation,{message:"Passwords don't match",path:["password_confirmation"]});n.email=S;const N=async()=>{r.value=!0;const s=F.safeParse(n);if(!s.success){const e=s.error.flatten().fieldErrors;o({title:"Validation Error",description:e.email[0],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),r.value=!1;return}try{n.post(route("password.request.otp"),{onSuccess:e=>{o({title:"Verification Code Sent",description:"Please check your email for the verification code",class:"text-primaryDark bg-white shadow-lg"}),u.value=2,i.email=n.email},onError:e=>{o({title:"Error",description:e.email||"Failed to send verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),r.value=!1}})}catch(e){console.error(e)}r.value=!1},T=async()=>{console.log(i.email),r.value=!0;const s=R.safeParse(i);if(!s.success){for(const e in V(s.error)?.fieldErrors){const a=V(s.error)?.fieldErrors[e][0];o({title:"Validation Error",description:a,variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}r.value=!1;return}try{i.post(route("password.verify"),{onSuccess:e=>{o({title:"Email Verified",description:"Please complete your registration",class:"text-primaryDark bg-white shadow-lg"}),d.email=i.email,d.otp=i.otp,u.value=3},onError:e=>{o({title:"Verification Failed",description:e.otp||"Invalid verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),console.log(e)}})}catch(e){console.error(e)}r.value=!1},A=async()=>{r.value=!0,console.log(i.email);try{n.post(route("password.request.opt"),{onSuccess:()=>{o({title:"Code Resent",description:"A new verification code has been sent to your email",class:"text-primaryDark bg-white shadow-lg"})},onError:()=>{o({title:"Error",description:"Failed to resend verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}})}catch(s){console.error(s)}r.value=!1},I=async()=>{r.value=!0,console.log(d.email);const s=q.safeParse(d);if(!s.success){const e=s.error.flatten().fieldErrors;for(const a in e){o({title:"Validation Error",description:e[a][0],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}r.value=!1;return}try{d.post(route("password.reset"),{onError:e=>{for(const a in e){o({title:"Password Reset Failed",description:e[a],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}},onSuccess:e=>{console.log(e),o({title:"Password Reset Successful",description:" Redirecting to login...",class:"text-primaryDark bg-white shadow-lg"})}})}catch(e){console.error(e)}r.value=!1};return(s,e)=>(m(),c(P,null,[p(l(L),{title:"Password Reset"}),p(j,null,{default:k(()=>[p(M),t("div",G,[t("div",H,[e[6]||(e[6]=t("div",{class:"p-6 grid space-y-1 bg-primaryDark rounded-t-lg"},[t("h2",{class:"text-2xl font-bold text-center text-white"},"Reset Password")],-1)),t("div",J,[u.value===1?(m(),c("form",{key:0,onSubmit:g(N,["prevent"]),class:"space-y-6"},[t("div",K,[e[2]||(e[2]=t("label",{for:"email",class:"text-lg lg:text-2xl font-medium"},"Email Address",-1)),_(t("input",{id:"email",type:"email",placeholder:"Enter your email",autocomplete:"email",autofocus:"","onUpdate:modelValue":e[0]||(e[0]=a=>l(n).email=a),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 text-xl focus:ring-primaryDark"},null,512),[[D,l(n).email]])]),t("button",{type:"submit",class:"w-full px-4 py-2.5 bg-primaryDark text-white font-medium rounded-lg lg:text-xl hover:bg-white hover:text-primaryDark hover:-translate-y-1 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:shadow-md hover:shadow-primaryDark/30",disabled:r.value},h(r.value?"Sending OTP...":"Send Verification Code"),9,Q),t("div",W,[t("p",X,[e[4]||(e[4]=E(" Already have an account? ",-1)),p(l(U),{href:s.route("login"),class:"text-primaryDark font-medium hover:text-primaryDark/80 transition-colors"},{default:k(()=>[...e[3]||(e[3]=[E(" Login ",-1)])]),_:1},8,["href"])])])],32)):y("",!0),u.value===2?(m(),c("form",{key:1,onSubmit:g(T,["prevent"]),class:"space-y-4"},[t("div",Y,[e[5]||(e[5]=t("label",{for:"otp",class:"text-lg lg:text-2xl font-medium"},"Verification Code",-1)),t("p",Z," Enter the 6-digit code sent to "+h(l(n).email),1),_(t("input",{id:"otp",type:"text",placeholder:"Enter 6-digit code",maxlength:"6","onUpdate:modelValue":e[1]||(e[1]=a=>l(i).otp=a),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primaryDark text-center text-2xl tracking-widest"},null,512),[[D,l(i).otp]])]),t("button",{type:"submit",class:"w-full px-4 py-2.5 bg-primaryDark hover:-translate-y-1 text-white text-xl font-medium rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:shadow-md hover:shadow-primaryDark/30",disabled:r.value},h(r.value?"Verifying...":"Verify Code"),9,ee),t("div",te,[t("button",{type:"button",onClick:A,class:"text-2xl text-primaryDark hover:text-primaryDark/80 hover:text-primaryDark transition-colors",disabled:r.value}," Resend Code ",8,re)])],32)):y("",!0),u.value===3?(m(),c("form",{key:2,onSubmit:g(I,["prevent"]),class:"space-y-4"},[(m(!0),c(P,null,B(C.value,a=>(m(),c("div",{class:"space-y-2",key:a.id},[t("label",{for:a.id,class:"text-lg lg:text-2xl font-medium"},h(a.name),9,ae),p($,{id:a.id,placeholder:a.placeholder,modelValue:l(d)[a.model],"onUpdate:modelValue":O=>l(d)[a.model]=O},null,8,["id","placeholder","modelValue","onUpdate:modelValue"])]))),128)),t("button",{type:"submit",class:"w-full px-4 py-2.5 bg-primaryDark hover:text-primaryDark hover:-translate-y-1 text-xl text-white font-medium rounded-lg hover:bg-white disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 hover:shadow-md hover:shadow-primaryDark/30",disabled:r.value},h(r.value?"Resetting Password...":"Reset Password"),9,se)],32)):y("",!0)])])])]),_:1})],64))}};export{ue as default};
