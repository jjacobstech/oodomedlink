import{f as y,h as v,i as p,a as w,e as i,j,w as D,b as r,k as g,o as c,p as b,l as x,v as E,t as u,x as V,y as B,F as P,m as A,c as L,z as M}from"./app-D_yhaELh.js";import{u as $,o as k,e as _,s as h,_ as z,a as G,f as S}from"./schemas-DPhLkQCd.js";import{_ as H}from"./AdminAuthLayout.vue_vue_type_script_setup_true_lang-peiG-jje.js";import"./x-OKIK-2Aq.js";import"./index-Bz87teyN.js";import"./ApplicationLogo.vue_vue_type_script_setup_true_lang-Cfo3q67c.js";import"./Wind-LiKkUfSx-QhjLDRXX.js";const J={class:"flex h-screen items-center justify-center overflow-y-hidden"},K={class:"max-w-lg items-center justify-center rounded-xl bg-white shadow-xl"},Q={class:"space-y-4 p-6"},W={class:"space-y-2"},X=["disabled"],Y={class:"mt-6 text-center"},Z={class:"text-lg text-gray-600"},ee={class:"space-y-2"},te={class:"mb-2 text-xs text-gray-500"},re=["disabled"],oe={class:"mt-4 text-center"},ae=["disabled"],se=["for"],ie=["id","type","placeholder","autocomplete","onUpdate:modelValue"],le=["disabled"],fe={__name:"ForgotPassword",setup(ne){const o=y(!1),m=y(1),{toast:s}=$(),C=sessionStorage.getItem("email"),d=v({email:""}),l=v({otp:"",email:""}),F=y([{id:"new-password",name:"New Password",placeholder:"Create a new password",type:"password",required:!0,autocomplete:"new-password",model:"password"},{id:"password_confirmation",name:"Confirm New Password",placeholder:"Confirm your new password",type:"password",required:!0,autocomplete:"new-password",model:"password_confirmation"}]),n=v({email:"",password:"",password_confirmation:"",otp:""}),R=k({email:_("Invalid email address").min(1,"Email is required")}),q=k({otp:h().length(6,"OTP must be 6 digits"),email:_("Invalid email address")}),N=k({email:_("Invalid email address").min(1,"Email is required"),otp:h().length(6,"OTP must be 6 digits"),password:h().min(6,"Password must be at least 6 characters"),password_confirmation:h().min(6,"Password confirmation is required")}).refine(a=>a.password===a.password_confirmation,{message:"Passwords don't match",path:["password_confirmation"]});d.email=C;const T=async()=>{o.value=!0;const a=R.safeParse(d);if(!a.success){const e=a.error.errors[0];s({title:"Validation Error",description:e.message,variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),o.value=!1;return}try{d.post(route("admin.password.request.otp"),{onSuccess:e=>{s({title:"Verification Code Sent",description:"Please check your email for the verification code",class:"text-primaryDark bg-white shadow-lg"}),m.value=2,l.email=d.email},onError:e=>{s({title:"Error",description:e.email||"Failed to send verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),o.value=!1}})}catch(e){console.error(e)}o.value=!1},U=async()=>{console.log(l.email),o.value=!0;const a=q.safeParse(l);if(!a.success){for(const e in S(a.error)?.fieldErrors){const t=S(a.error)?.fieldErrors[e][0];s({title:"Validation Error",description:t,variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}o.value=!1;return}try{l.post(route("admin.password.verify"),{onSuccess:e=>{s({title:"Email Verified",description:"Please complete your registration",class:"text-primaryDark bg-white shadow-lg"}),n.email=l.email,n.otp=l.otp,m.value=3},onError:e=>{s({title:"Verification Failed",description:e.otp||"Invalid verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),console.log(e)}})}catch(e){console.error(e)}o.value=!1},I=async()=>{o.value=!0,console.log(l.email);try{d.post(route("admin.password.request.opt"),{onSuccess:()=>{s({title:"Code Resent",description:"A new verification code has been sent to your email",class:"text-primaryDark bg-white shadow-lg"})},onError:()=>{s({title:"Error",description:"Failed to resend verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}})}catch(a){console.error(a)}o.value=!1},O=async()=>{o.value=!0,console.log(n.email);const a=N.safeParse(n);if(!a.success){const e=a.error.flatten().fieldErrors;for(const t in e){s({title:"Validation Error",description:e[t][0],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}o.value=!1;return}try{n.post(route("admin.password.reset"),{onError:e=>{for(const t in e){s({title:"Password Reset Failed",description:e[t],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}},onSuccess:e=>{console.log(e),s({title:"Password Reset Successful",description:" Redirecting to login...",class:"text-primaryDark bg-white shadow-lg"})}})}catch(e){console.error(e)}o.value=!1};return(a,e)=>(c(),p(P,null,[w(i(j),{title:"Password Reset"}),w(H,null,{default:D(()=>[w(z),r("div",J,[r("div",K,[e[6]||(e[6]=r("div",{class:"bg-primaryDark grid space-y-1 rounded-t-lg p-6"},[r("h2",{class:"text-center text-2xl font-bold text-white"}," Reset Password ")],-1)),r("div",Q,[m.value===1?(c(),p("form",{key:0,onSubmit:b(T,["prevent"]),class:"space-y-4"},[r("div",W,[e[2]||(e[2]=r("label",{for:"email",class:"text-lg font-extrabold"},"Email Address",-1)),x(r("input",{id:"email",type:"email",placeholder:"Enter your email",autocomplete:"email",autofocus:"","onUpdate:modelValue":e[0]||(e[0]=t=>i(d).email=t),class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,512),[[E,i(d).email]])]),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},u(o.value?"Sending OTP...":"Send Verification Code"),9,X),r("div",Y,[r("p",Z,[e[4]||(e[4]=V(" Already have an account? ",-1)),w(i(B),{href:a.route("admin.login"),class:"text-primaryDark hover:text-primaryDark /80 font-extrabold transition-colors"},{default:D(()=>[...e[3]||(e[3]=[V(" Login ",-1)])]),_:1},8,["href"])])])],32)):g("",!0),m.value===2?(c(),p("form",{key:1,onSubmit:b(U,["prevent"]),class:"space-y-4"},[r("div",ee,[e[5]||(e[5]=r("label",{for:"otp",class:"text-lg font-extrabold"},"Verification Code",-1)),r("p",te," Enter the 6-digit code sent to "+u(i(d).email),1),x(r("input",{id:"otp",type:"text",placeholder:"Enter 6-digit code",maxlength:"6","onUpdate:modelValue":e[1]||(e[1]=t=>i(l).otp=t),class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 text-center text-2xl tracking-widest focus:outline-none focus:ring-2"},null,512),[[E,i(l).otp]])]),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},u(o.value?"Verifying...":"Verify Code"),9,re),r("div",oe,[r("button",{type:"button",onClick:I,class:"text-primaryDark hover:text-primaryDark /80 text-lg transition-colors",disabled:o.value}," Resend Code ",8,ae)])],32)):g("",!0),m.value===3?(c(),p("form",{key:2,onSubmit:b(O,["prevent"]),class:"h-full space-y-4"},[(c(!0),p(P,null,A(F.value,t=>(c(),p("div",{class:"space-y-2",key:t.id},[r("label",{for:t.id,class:"text-lg font-extrabold"},u(t.name),9,se),t.type!=="password"?x((c(),p("input",{key:0,id:t.id,type:t.type,placeholder:t.placeholder,autocomplete:t.autocomplete,"onUpdate:modelValue":f=>i(n)[t.model]=f,class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,8,ie)),[[M,i(n)[t.model]]]):(c(),L(G,{key:1,id:t.id,placeholder:t.placeholder,modelValue:i(n)[t.model],"onUpdate:modelValue":f=>i(n)[t.model]=f},null,8,["id","placeholder","modelValue","onUpdate:modelValue"]))]))),128)),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},u(o.value?"Resetting Password...":"Reset Password"),9,le)],32)):g("",!0)])])])]),_:1})],64))}};export{fe as default};
