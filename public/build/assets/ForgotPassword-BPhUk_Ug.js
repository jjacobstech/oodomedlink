import{r as y,a as v,g as p,e as w,b as i,p as A,w as D,f as r,q as g,o as n,z as b,v as x,x as E,t as m,y as V,l as B,F as P,h as j,c as L,A as M}from"./app-CrnLZw8q.js";import{o as _,e as k,s as h,_ as $,f as S}from"./schemas-RwLSKait.js";import{_ as z}from"./AdminAuthLayout.vue_vue_type_script_setup_true_lang-DZcTmrkv.js";import{u as G,_ as H}from"./index-Bf2nrSjv.js";import"./createLucideIcon-D8Cn5WI2.js";import"./index-DHOgxrP6.js";import"./x-Bv16Pp3K.js";const J={class:"flex h-screen items-center justify-center overflow-y-hidden"},K={class:"max-w-lg items-center justify-center rounded-xl bg-white shadow-xl"},Q={class:"space-y-4 p-6"},W={class:"space-y-2"},X=["disabled"],Y={class:"mt-6 text-center"},Z={class:"text-lg text-gray-600"},ee={class:"space-y-2"},te={class:"mb-2 text-xs text-gray-500"},re=["disabled"],ae={class:"mt-4 text-center"},se=["disabled"],oe=["for"],ie=["id","type","placeholder","autocomplete","onUpdate:modelValue"],le=["disabled"],fe={__name:"ForgotPassword",setup(de){const a=y(!1),u=y(1),{toast:o}=G(),C=sessionStorage.getItem("email"),l=v({email:""}),c=v({otp:"",email:""}),F=y([{id:"new-password",name:"New Password",placeholder:"Create a new password",type:"password",required:!0,autocomplete:"new-password",model:"password"},{id:"password_confirmation",name:"Confirm New Password",placeholder:"Confirm your new password",type:"password",required:!0,autocomplete:"new-password",model:"password_confirmation"}]),d=v({email:"",password:"",password_confirmation:"",otp:""}),R=_({email:k("Invalid email address").min(1,"Email is required")}),q=_({otp:h().length(6,"OTP must be 6 digits"),email:k("Invalid email address")}),N=_({email:k("Invalid email address").min(1,"Email is required"),otp:h().length(6,"OTP must be 6 digits"),password:h().min(6,"Password must be at least 6 characters"),password_confirmation:h().min(6,"Password confirmation is required")}).refine(s=>s.password===s.password_confirmation,{message:"Passwords don't match",path:["password_confirmation"]});l.email=C;const T=async()=>{a.value=!0;const s=R.safeParse(l);if(!s.success){const e=s.error.errors[0];o({title:"Validation Error",description:e.message,variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),a.value=!1;return}try{l.post(route("admin.password.request.otp"),{onSuccess:e=>{o({title:"Verification Code Sent",description:"Please check your email for the verification code",class:"text-primaryDark bg-white shadow-lg"}),u.value=2,c.email=l.email},onError:e=>{o({title:"Error",description:e.email||"Failed to send verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"}),a.value=!1}})}catch{}a.value=!1},U=async()=>{a.value=!0;const s=q.safeParse(c);if(!s.success){for(const e in S(s.error)?.fieldErrors){const t=S(s.error)?.fieldErrors[e][0];o({title:"Validation Error",description:t,variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}a.value=!1;return}try{c.post(route("admin.password.verify"),{onSuccess:e=>{o({title:"Email Verified",description:"Please complete your registration",class:"text-primaryDark bg-white shadow-lg"}),d.email=c.email,d.otp=c.otp,u.value=3},onError:e=>{o({title:"Verification Failed",description:e.otp||"Invalid verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}})}catch{}a.value=!1},I=async()=>{a.value=!0;try{l.post(route("admin.password.request.opt"),{onSuccess:()=>{o({title:"Code Resent",description:"A new verification code has been sent to your email",class:"text-primaryDark bg-white shadow-lg"})},onError:()=>{o({title:"Error",description:"Failed to resend verification code",variant:"destructive",class:"text-primaryDark bg-white shadow-lg"})}})}catch{}a.value=!1},O=async()=>{a.value=!0;const s=N.safeParse(d);if(!s.success){const e=s.error.flatten().fieldErrors;for(const t in e){o({title:"Validation Error",description:e[t][0],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}a.value=!1;return}try{d.post(route("admin.password.reset"),{onError:e=>{for(const t in e){o({title:"Password Reset Failed",description:e[t],variant:"destructive",class:"text-primaryDark bg-white shadow-lg"});break}},onSuccess:e=>{o({title:"Password Reset Successful",description:" Redirecting to login...",class:"text-primaryDark bg-white shadow-lg"})}})}catch{}a.value=!1};return(s,e)=>(n(),p(P,null,[w(i(A),{title:"Password Reset"}),w(z,null,{default:D(()=>[w(H),r("div",J,[r("div",K,[e[6]||(e[6]=r("div",{class:"bg-primaryDark grid space-y-1 rounded-t-lg p-6"},[r("h2",{class:"text-center text-2xl font-bold text-white"}," Reset Password ")],-1)),r("div",Q,[u.value===1?(n(),p("form",{key:0,onSubmit:b(T,["prevent"]),class:"space-y-4"},[r("div",W,[e[2]||(e[2]=r("label",{for:"email",class:"text-lg font-extrabold"},"Email Address",-1)),x(r("input",{id:"email",type:"email",placeholder:"Enter your email",autocomplete:"email",autofocus:"","onUpdate:modelValue":e[0]||(e[0]=t=>i(l).email=t),class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,512),[[E,i(l).email]])]),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:a.value},m(a.value?"Sending OTP...":"Send Verification Code"),9,X),r("div",Y,[r("p",Z,[e[4]||(e[4]=V(" Already have an account? ",-1)),w(i(B),{href:s.route("admin.login"),class:"text-primaryDark hover:text-primaryDark /80 font-extrabold transition-colors"},{default:D(()=>[...e[3]||(e[3]=[V(" Login ",-1)])]),_:1},8,["href"])])])],32)):g("",!0),u.value===2?(n(),p("form",{key:1,onSubmit:b(U,["prevent"]),class:"space-y-4"},[r("div",ee,[e[5]||(e[5]=r("label",{for:"otp",class:"text-lg font-extrabold"},"Verification Code",-1)),r("p",te," Enter the 6-digit code sent to "+m(i(l).email),1),x(r("input",{id:"otp",type:"text",placeholder:"Enter 6-digit code",maxlength:"6","onUpdate:modelValue":e[1]||(e[1]=t=>i(c).otp=t),class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 text-center text-2xl tracking-widest focus:outline-none focus:ring-2"},null,512),[[E,i(c).otp]])]),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:a.value},m(a.value?"Verifying...":"Verify Code"),9,re),r("div",ae,[r("button",{type:"button",onClick:I,class:"text-primaryDark hover:text-primaryDark /80 text-lg transition-colors",disabled:a.value}," Resend Code ",8,se)])],32)):g("",!0),u.value===3?(n(),p("form",{key:2,onSubmit:b(O,["prevent"]),class:"h-full space-y-4"},[(n(!0),p(P,null,j(F.value,t=>(n(),p("div",{class:"space-y-2",key:t.id},[r("label",{for:t.id,class:"text-lg font-extrabold"},m(t.name),9,oe),t.type!=="password"?x((n(),p("input",{key:0,id:t.id,type:t.type,placeholder:t.placeholder,autocomplete:t.autocomplete,"onUpdate:modelValue":f=>i(d)[t.model]=f,class:"focus:ring-primaryDark w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,8,ie)),[[M,i(d)[t.model]]]):(n(),L($,{key:1,id:t.id,placeholder:t.placeholder,modelValue:i(d)[t.model],"onUpdate:modelValue":f=>i(d)[t.model]=f},null,8,["id","placeholder","modelValue","onUpdate:modelValue"]))]))),128)),r("button",{type:"submit",class:"bg-primaryDark hover:shadow-primaryDark /30 w-full rounded-lg px-4 py-2.5 font-extrabold text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:a.value},m(a.value?"Resetting Password...":"Reset Password"),9,le)],32)):g("",!0)])])])]),_:1})],64))}};export{fe as default};
