import{d as F,r as b,a as r,b as k,e as $,h as P,w as N,f as e,g as p,o as n,F as x,j as f,n as v,t as a,i as V,v as z,m as A,k as C,l as h,u as M}from"./app-D2V0QdeW.js";import{_ as T}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-CjQ8sXCa.js";import"./index-UBeE2Aye.js";import"./x-DVayrmzf.js";import"./index-CHKb_DJ8.js";import"./ApplicationLogo.vue_vue_type_script_setup_true_lang-BRc7ZUHv.js";import"./Wind-LiKkUfSx-CKihqZMt.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"h-full w-full bg-gray-100"},R={class:"overflow-y-scroll p-6"},U={class:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},K={class:"flex flex-wrap gap-2 sm:gap-3"},L=["onClick"],I={class:"flex gap-2 sm:gap-3 justify-between items-center w-full sm:w-auto"},Q={class:"relative flex-1 sm:flex-initial"},q={class:"flex gap-2 items-center"},G={class:"mb-4 text-sm text-gray-600"},H={class:"overflow-x-auto rounded-xl bg-white shadow-md"},J={class:"w-full text-sm"},O={class:"divide-y divide-gray-200"},W={class:"px-4 py-3 font-medium text-gray-800"},X={class:"px-4 py-3 text-gray-700"},Y={class:"max-w-[200px] truncate px-4 py-3 text-gray-700"},Z={class:"px-4 py-3 text-gray-600"},ee={class:"px-4 py-3"},te={class:"px-4 py-3"},se={class:"flex gap-2"},le=["onClick"],ae=["onClick"],oe={key:0},re={key:0,class:"mt-6 flex items-center justify-between"},ne=["disabled"],ie={class:"text-sm text-gray-600"},de=["disabled"],ue={class:"w-full max-w-4xl p-6 bg-white rounded-xl max-h-[90vh] overflow-y-auto"},ce={class:"mb-4 flex items-center justify-between"},pe={class:"text-2xl font-bold text-gray-800"},xe={class:"mb-4 text-sm text-gray-600 space-y-1"},ge={class:"rounded-lg bg-gray-50 p-4 text-gray-700 mb-4"},me={class:"whitespace-pre-wrap"},ye={key:0,class:"space-y-4"},be={key:0,class:"text-center w-full"},fe=["src","alt"],ve=["onClick"],he={key:1,class:"text-center w-full"},_e=["src"],we=["onClick"],ke={key:2,class:"text-center"},Ce={class:"mt-4 text-gray-600 font-medium"},Se=["onClick"],ze=F({__name:"Emails",props:{emails:{},search:{},filter:{},error:{}},setup(i){const g=i,d=b(g.filter||"all"),u=b(g.search||""),l=b(null),S=["all","pending","sent","failed","scheduled"];console.log("Props:",g);const m=o=>{window.open(o.file_url,"_blank")},y=o=>{o!==void 0&&(d.value=o);const s={};d.value&&d.value!=="all"&&(s.filter=d.value),u.value&&u.value.trim()!==""&&(s.search=u.value.trim()),h.get(route("user.emails"),s,{onError:t=>{console.error("Filter error:",t)},preserveScroll:!0,preserveState:!0})},D=()=>{d.value="all",u.value="",h.get(route("user.emails"),{},{onError:o=>{console.error("Clear error:",o)},preserveScroll:!0,preserveState:!0})},_=o=>{o&&h.get(o,{},{preserveScroll:!0,preserveState:!0})},w=o=>new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),j=o=>{const s=M({id:o.id});console.log("send"),console.log(o.patient_email),s.post(route("user.email.retry"),{onSuccess:()=>{alert("Email retry initiated successfully")},onError:t=>{console.error("Retry error:",t),alert("Failed to retry email")}})},E=o=>{o.key==="Enter"&&y()};return(o,s)=>(n(),r(x,null,[k($(P),{title:"Email Management"}),k(T,null,{default:N(()=>[e("div",B,[e("div",R,[s[14]||(s[14]=e("div",{class:"mb-6"},[e("h1",{class:"text-3xl font-bold text-gray-800"}," Patient Emails "),e("p",{class:"text-gray-600"}," Monitor and manage all sent emails to patients ")],-1)),e("div",U,[e("div",K,[(n(),r(x,null,f(S,t=>e("button",{key:t,onClick:c=>y(t),class:v([d.value===t?"bg-primaryDark text-white":"bg-gray-200 text-gray-700","px-3 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-sm lg:text-base font-medium rounded-lg transition-all hover:shadow-md"])},a(t.charAt(0).toUpperCase()+t.slice(1)),11,L)),64))]),e("div",I,[e("div",Q,[V(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>u.value=t),type:"text",placeholder:"Search by patient name...",onKeydown:E,class:"w-full rounded-lg border border-gray-300 px-4 py-2 pl-10 focus:border-transparent focus:ring-2 focus:ring-primaryDark md:w-80"},null,544),[[z,u.value]]),s[6]||(s[6]=e("span",{class:"absolute left-3 top-1/2 -translate-y-1/2 transform text-gray-400"},"ðŸ”",-1))]),e("div",q,[e("button",{onClick:s[1]||(s[1]=t=>y()),class:"px-3 sm:px-4 py-2 text-sm sm:text-base font-semibold text-white transition-all bg-primaryDark rounded-lg hover:bg-primaryDark/90 hover:shadow-lg whitespace-nowrap"}," Search "),e("button",{onClick:D,class:"px-3 sm:px-4 py-2 text-sm sm:text-base font-semibold text-white transition-all bg-gray-600 rounded-lg hover:bg-gray-700 hover:shadow-lg whitespace-nowrap"}," Clear ")])])]),e("div",G,[e("p",null," Showing "+a(i.emails.from||0)+" to "+a(i.emails.to||0)+" of "+a(i.emails.total)+" emails ",1)]),e("div",H,[e("table",J,[s[8]||(s[8]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Patient "),e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Email "),e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Subject "),e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Sent At "),e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Status "),e("th",{class:"px-4 py-3 text-left text-xs font-semibold uppercase text-gray-700"}," Actions ")])],-1)),e("tbody",O,[(n(!0),r(x,null,f(i.emails.data,t=>(n(),r("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",W,a(t.patient.full_name),1),e("td",X,a(t.patient.email),1),e("td",Y,a(t.subject),1),e("td",Z,a(w(t.sent_at)),1),e("td",ee,[e("span",{class:v([{"bg-green-100 text-green-800":t.status==="sent","bg-red-100 text-red-800":t.status==="failed","bg-orange-100 text-orange-800":t.status==="pending","bg-primaryDark text-white":t.status==="scheduled"},"rounded-full px-3 py-1 text-xs font-semibold capitalize"])},a(t.status.replace("_"," ")),3)]),e("td",te,[e("div",se,[e("button",{onClick:c=>l.value=t,class:"rounded bg-blue-100 px-3 py-1 text-xs font-medium text-blue-700 transition hover:bg-blue-200"}," View ",8,le),t.status==="failed"||t.status==="scheduled"?(n(),r("button",{key:0,onClick:c=>j(t),class:"rounded bg-red-100 px-3 py-1 text-xs font-medium text-red-700 transition hover:bg-red-200"}," Retry ",8,ae)):p("",!0)])])]))),128)),i.emails.data.length===0?(n(),r("tr",oe,[...s[7]||(s[7]=[e("td",{colspan:"6",class:"px-4 py-8 text-center text-gray-500"}," No emails found. ",-1)])])):p("",!0)])])]),i.emails.last_page>1?(n(),r("div",re,[e("button",{onClick:s[2]||(s[2]=t=>_(i.emails.prev_page_url)),disabled:!i.emails.prev_page_url,class:"rounded-lg bg-primaryDark px-4 py-2 text-sm font-semibold text-white transition hover:bg-primaryDark/90 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Previous ",8,ne),e("span",ie," Page "+a(i.emails.current_page)+" of "+a(i.emails.last_page),1),e("button",{onClick:s[3]||(s[3]=t=>_(i.emails.next_page_url)),disabled:!i.emails.next_page_url,class:"rounded-lg bg-primaryDark px-4 py-2 text-sm font-semibold text-white transition hover:bg-primaryDark/90 disabled:bg-gray-300 disabled:cursor-not-allowed"}," Next ",8,de)])):p("",!0),l.value?(n(),r("div",{key:1,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onClick:s[5]||(s[5]=A(t=>l.value=null,["self"]))},[e("div",ue,[e("div",ce,[e("h3",pe,a(l.value.subject),1),e("button",{onClick:s[4]||(s[4]=t=>l.value=null),class:"rounded-lg bg-gray-200 px-4 py-2 text-gray-700 hover:bg-gray-300"}," Close ")]),e("div",xe,[e("p",null,[s[9]||(s[9]=e("strong",null,"To:",-1)),C(" "+a(l.value.patient.full_name)+" ("+a(l.value.patient_email)+") ",1)]),e("p",null,[s[10]||(s[10]=e("strong",null,"Sent:",-1)),C(" "+a(w(l.value.sent_at)),1)]),e("p",null,[s[11]||(s[11]=e("strong",null,"Status:",-1)),e("span",{class:v([{"text-green-700":l.value.status==="sent","text-red-700":l.value.status==="failed","text-orange-700":l.value.status==="pending","bg-primaryDark text-white":l.value.status==="scheduled"},"font-semibold capitalize"])},a(l.value.status.replace("_"," ")),3)])]),e("div",ge,[e("p",me,a(l.value.message_preview),1)]),l.value.result&&l.value.result.files&&l.value.result.files.length>0?(n(),r("div",ye,[s[13]||(s[13]=e("h4",{class:"text-lg font-semibold text-gray-800"}," Attachments ",-1)),(n(!0),r(x,null,f(l.value.result.files,t=>(n(),r("div",{key:t.id,class:"flex items-center justify-center p-8 bg-gray-100 rounded-lg"},[t.file_type==="image/png"||t.file_type==="image/jpg"||t.file_type==="image/jpeg"?(n(),r("div",be,[e("img",{src:t.file_url,alt:t.original_file_name,class:"max-w-full max-h-96 mx-auto rounded-lg shadow"},null,8,fe),e("button",{onClick:c=>m(t),class:"px-4 py-2 mt-4 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700"}," Download Image ",8,ve)])):t.file_type==="application/pdf"?(n(),r("div",he,[e("iframe",{src:t.file_url,class:"w-full h-96 rounded-lg"},null,8,_e),e("button",{onClick:c=>m(t),class:"px-4 py-2 mt-4 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700"}," Download PDF ",8,we)])):(n(),r("div",ke,[s[12]||(s[12]=e("span",{class:"text-6xl"},"ðŸ“„",-1)),e("p",Ce,a(t.original_file_name),1),e("button",{onClick:c=>m(t),class:"px-4 py-2 mt-4 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700"}," Download File ",8,Se)]))]))),128))])):p("",!0)])])):p("",!0)])])]),_:1})],64))}});export{ze as default};
