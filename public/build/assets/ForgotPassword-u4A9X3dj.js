import{r as f,a as v,g as u,e as w,b as i,p as B,w as V,f as s,i as b,o as c,s as y,q as x,v as P,t as m,z as S,l as j,F as k,h as D,c as L,A as M}from"./app-BVFE2lrP.js";import{u as $,o as _,e as E,s as h,_ as z,a as G,f as C}from"./schemas-DCfXlZ27.js";import{_ as H}from"./AdminAuthLayout.vue_vue_type_script_setup_true_lang-Baw4Nm9A.js";import"./x-vP5drbxd.js";import"./index-CkCug2Ue.js";import"./ApplicationLogo.vue_vue_type_script_setup_true_lang-BmW6gCb4.js";import"./Wind-LiKkUfSx-Cwx98uFo.js";const J={class:"flex h-screen items-center justify-center overflow-y-hidden"},K={class:"max-w-lg items-center justify-center rounded-xl bg-white shadow-xl"},Q={class:"space-y-4 p-6"},W={class:"space-y-2"},X=["disabled"],Y={class:"mt-6 text-center"},Z={class:"text-sm text-gray-600"},ee={class:"space-y-2"},te={class:"mb-2 text-xs text-gray-500"},se=["disabled"],oe={class:"mt-4 text-center"},ae=["disabled"],re=["for"],ie=["id","type","placeholder","autocomplete","onUpdate:modelValue"],le=["disabled"],ge={__name:"ForgotPassword",setup(de){const o=f(!1),p=f(1),{toast:r}=$(),F=sessionStorage.getItem("email"),n=v({email:""}),l=v({otp:"",email:""}),R=f([{id:"new-password",name:"New Password",placeholder:"Create a new password",type:"password",required:!0,autocomplete:"new-password",model:"password"},{id:"password_confirmation",name:"Confirm New Password",placeholder:"Confirm your new password",type:"password",required:!0,autocomplete:"new-password",model:"password_confirmation"}]),d=v({email:"",password:"",password_confirmation:"",otp:""}),q=_({email:E("Invalid email address").min(1,"Email is required")}),N=_({otp:h().length(6,"OTP must be 6 digits"),email:E("Invalid email address")}),T=_({email:E("Invalid email address").min(1,"Email is required"),otp:h().length(6,"OTP must be 6 digits"),password:h().min(6,"Password must be at least 6 characters"),password_confirmation:h().min(6,"Password confirmation is required")}).refine(a=>a.password===a.password_confirmation,{message:"Passwords don't match",path:["password_confirmation"]});n.email=F;const U=async()=>{o.value=!0;const a=q.safeParse(n);if(!a.success){const e=a.error.errors[0];r({title:"Validation Error",description:e.message,variant:"destructive",class:"text-deepblue bg-white shadow-lg"}),o.value=!1;return}try{n.post(route("admin.password.request.otp"),{onSuccess:e=>{r({title:"Verification Code Sent",description:"Please check your email for the verification code",class:"text-deepblue bg-white shadow-lg"}),p.value=2,l.email=n.email},onError:e=>{r({title:"Error",description:e.email||"Failed to send verification code",variant:"destructive",class:"text-deepblue bg-white shadow-lg"}),o.value=!1}})}catch(e){console.error(e)}o.value=!1},I=async()=>{console.log(l.email),o.value=!0;const a=N.safeParse(l);if(!a.success){for(const e in C(a.error)?.fieldErrors){const t=C(a.error)?.fieldErrors[e][0];r({title:"Validation Error",description:t,variant:"destructive",class:"text-deepblue bg-white shadow-lg"})}o.value=!1;return}try{l.post(route("admin.password.verify"),{onSuccess:e=>{r({title:"Email Verified",description:"Please complete your registration",class:"text-deepblue bg-white shadow-lg"}),d.email=l.email,d.otp=l.otp,p.value=3},onError:e=>{r({title:"Verification Failed",description:e.otp||"Invalid verification code",variant:"destructive",class:"text-deepblue bg-white shadow-lg"}),console.log(e)}})}catch(e){console.error(e)}o.value=!1},O=async()=>{o.value=!0,console.log(l.email);try{n.post(route("admin.password.request.opt"),{onSuccess:()=>{r({title:"Code Resent",description:"A new verification code has been sent to your email",class:"text-deepblue bg-white shadow-lg"})},onError:()=>{r({title:"Error",description:"Failed to resend verification code",variant:"destructive",class:"text-deepblue bg-white shadow-lg"})}})}catch(a){console.error(a)}o.value=!1},A=async()=>{o.value=!0,console.log(d.email);const a=T.safeParse(d);if(!a.success){const e=a.error.flatten().fieldErrors;for(const t in e){r({title:"Validation Error",description:e[t][0],variant:"destructive",class:"text-deepblue bg-white shadow-lg"});break}o.value=!1;return}try{d.post(route("admin.password.reset"),{onError:e=>{for(const t in e){r({title:"Password Reset Failed",description:e[t],variant:"destructive",class:"text-deepblue bg-white shadow-lg"});break}},onSuccess:e=>{console.log(e),r({title:"Password Reset Successful",description:" Redirecting to login...",class:"text-deepblue bg-white shadow-lg"})}})}catch(e){console.error(e)}o.value=!1};return(a,e)=>(c(),u(k,null,[w(i(B),{title:"Password Reset"}),w(H,null,{default:V(()=>[w(z),s("div",J,[s("div",K,[e[6]||(e[6]=s("div",{class:"bg-deepgradient grid space-y-1 rounded-t-lg p-6"},[s("h2",{class:"text-center text-2xl font-bold text-white"}," Reset Password ")],-1)),s("div",Q,[p.value===1?(c(),u("form",{key:0,onSubmit:y(U,["prevent"]),class:"space-y-4"},[s("div",W,[e[2]||(e[2]=s("label",{for:"email",class:"text-sm font-medium"},"Email Address",-1)),x(s("input",{id:"email",type:"email",placeholder:"Enter your email",autocomplete:"email",autofocus:"","onUpdate:modelValue":e[0]||(e[0]=t=>i(n).email=t),class:"focus:ring-deepgreen w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,512),[[P,i(n).email]])]),s("button",{type:"submit",class:"bg-deepgradient hover:shadow-deepgreen/30 w-full rounded-lg px-4 py-2.5 font-medium text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},m(o.value?"Sending OTP...":"Send Verification Code"),9,X),s("div",Y,[s("p",Z,[e[4]||(e[4]=S(" Already have an account? ",-1)),w(i(j),{href:a.route("admin.login"),class:"text-deepgreen hover:text-deepgreen/80 font-medium transition-colors"},{default:V(()=>[...e[3]||(e[3]=[S(" Login ",-1)])]),_:1},8,["href"])])])],32)):b("",!0),p.value===2?(c(),u("form",{key:1,onSubmit:y(I,["prevent"]),class:"space-y-4"},[s("div",ee,[e[5]||(e[5]=s("label",{for:"otp",class:"text-sm font-medium"},"Verification Code",-1)),s("p",te," Enter the 6-digit code sent to "+m(i(n).email),1),x(s("input",{id:"otp",type:"text",placeholder:"Enter 6-digit code",maxlength:"6","onUpdate:modelValue":e[1]||(e[1]=t=>i(l).otp=t),class:"focus:ring-deepgreen w-full rounded-md border border-gray-300 px-3 py-2 text-center text-2xl tracking-widest focus:outline-none focus:ring-2"},null,512),[[P,i(l).otp]])]),s("button",{type:"submit",class:"bg-deepgradient hover:shadow-deepgreen/30 w-full rounded-lg px-4 py-2.5 font-medium text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},m(o.value?"Verifying...":"Verify Code"),9,se),s("div",oe,[s("button",{type:"button",onClick:O,class:"text-deepgreen hover:text-deepgreen/80 text-sm transition-colors",disabled:o.value}," Resend Code ",8,ae)])],32)):b("",!0),p.value===3?(c(),u("form",{key:2,onSubmit:y(A,["prevent"]),class:"h-full space-y-4"},[(c(!0),u(k,null,D(R.value,t=>(c(),u("div",{class:"space-y-2",key:t.id},[s("label",{for:t.id,class:"text-sm font-medium"},m(t.name),9,re),t.type!=="password"?x((c(),u("input",{key:0,id:t.id,type:t.type,placeholder:t.placeholder,autocomplete:t.autocomplete,"onUpdate:modelValue":g=>i(d)[t.model]=g,class:"focus:ring-deepgreen w-full rounded-md border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2"},null,8,ie)),[[M,i(d)[t.model]]]):(c(),L(G,{key:1,id:t.id,placeholder:t.placeholder,modelValue:i(d)[t.model],"onUpdate:modelValue":g=>i(d)[t.model]=g},null,8,["id","placeholder","modelValue","onUpdate:modelValue"]))]))),128)),s("button",{type:"submit",class:"bg-deepgradient hover:shadow-deepgreen/30 w-full rounded-lg px-4 py-2.5 font-medium text-white transition-all duration-200 hover:-translate-y-1 hover:bg-white hover:shadow-md disabled:cursor-not-allowed disabled:opacity-50",disabled:o.value},m(o.value?"Resetting Password...":"Reset Password"),9,le)],32)):b("",!0)])])])]),_:1})],64))}};export{ge as default};
